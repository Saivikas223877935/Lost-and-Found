<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lost & Found</title>

  <!-- Materialize + Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <!-- Theme / App styles -->
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
  <!-- Navbar -->
  <nav class="nav-wrapper blue darken-2">
    <div class="container" style="display:flex; align-items:center; justify-content:space-between;">
      <a href="/" class="brand-logo">
        <img class="brand-logo-img" src="images/logo.png" alt="logo">
      </a>

      <!-- Theme toggle + nav items -->
      <div style="display:flex; align-items:center; gap:12px;">
        <button id="themeToggle" class="theme-toggle">
          <i class="material-icons">dark_mode</i>
          <span id="themeLabel"></span>
        </button>

        <ul id="nav-mobile" class="right hide-on-med-and-down" style="margin-left:10px;">
          <li><a href="#list">Browse</a></li>
          <li><a href="#report">Report</a></li>
          <li><a href="#mine">My Items</a></li>
          <li id="nav-auth"><a href="login.html" id="loginLink">Login</a></li>
          <li id="nav-logout" style="display:none;"><a href="#" id="logoutBtn">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="main-body">
    <div class="container">
      <!-- Hero -->
      <div class="row center-align">
        <div class="col s12">
          <h4>Lost & Found Board</h4>
          <p class="flow-text">Post lost or found items and get matched fast.</p>
          <p>Live new items: <span id="liveCount">0</span> | Latest: <span id="latestNew">—</span></p>
        </div>
      </div>

      <!-- Filters (glass card) -->
      <div class="row">
        <div class="col s12">
          <div class="filters-card">
            <div class="input-field" style="margin:0; min-width:180px;">
              <select id="filterType">
                <option value="">All</option>
                <option value="lost">Lost</option>
                <option value="found">Found</option>
              </select>
              <label>Filter by type</label>
            </div>
            <div style="flex:1;"></div>
            <a class="btn waves-effect" id="refreshBtn"><i class="material-icons left">refresh</i>Refresh</a>
            <a class="btn waves-effect" href="#report"><i class="material-icons left">add_circle</i>Report</a>
          </div>
        </div>
      </div>

      <!-- Tabs + Grids -->
      <div class="row">
        <div class="col s12">
          <ul class="tabs">
            <li class="tab col s3"><a class="active" href="#tab-all">All</a></li>
            <li class="tab col s3"><a href="#tab-lost">Lost</a></li>
            <li class="tab col s3"><a href="#tab-found">Found</a></li>
            <li class="tab col s3"><a href="#tab-mine">Mine</a></li>
          </ul>
        </div>
        <div id="tab-all" class="col s12 section"><div class="row" id="cards-all"></div></div>
        <div id="tab-lost" class="col s12 section"><div class="row" id="cards-lost"></div></div>
        <div id="tab-found" class="col s12 section"><div class="row" id="cards-found"></div></div>
        <div id="tab-mine" class="col s12 section"><div class="row" id="cards-mine"></div></div>
      </div>

      <!-- Report form -->
      <div id="report" class="row">
        <div class="col s12">
          <h5>Report an Item</h5>
          <p class="grey-text">You must be logged in to report items.</p>
        </div>
        <form id="reportForm" class="col s12 card-panel" enctype="multipart/form-data" novalidate>
          <div class="row">
            <div class="input-field col s12 m6">
              <input id="title" name="title" type="text" required>
              <label for="title">Title</label>
            </div>

            <!-- native select for focusable validation -->
            <div class="col s12 m6">
              <label for="type" class="active" style="font-size:0.9rem;color:#9e9e9e;">Type</label>
              <select id="type" name="type" class="browser-default">
                <option value="">Choose type</option>
                <option value="lost">Lost</option>
                <option value="found">Found</option>
              </select>
            </div>

            <div class="input-field col s12 m6">
              <input id="date" name="date" type="date" required>
              <label for="date" class="active">Date</label>
            </div>
            <div class="input-field col s12 m6">
              <input id="location" name="location" type="text" required>
              <label for="location">Location</label>
            </div>
            <div class="input-field col s12 m6">
              <input id="contactEmail" name="contactEmail" type="email" required>
              <label for="contactEmail">Contact Email</label>
            </div>
            <div class="input-field col s12">
              <textarea id="description" name="description" class="materialize-textarea"></textarea>
              <label for="description">Description</label>
            </div>

            <!-- URL/filename or file attachment -->
            <div class="input-field col s12 m6">
              <input id="imageUrl" name="imageUrl" type="text" placeholder="images/image1.png (optional)">
              <label for="imageUrl" class="active">Image URL / Filename (optional)</label>
            </div>
            <div class="file-field input-field col s12 m6">
              <div class="btn">
                <span>Attach</span>
                <input id="imageFile" name="imageFile" type="file" accept="image/*">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="Attach an image (optional)">
              </div>
            </div>
          </div>
          <button class="btn waves-effect waves-light" type="submit" id="formSubmit">
            Submit <i class="material-icons right">send</i>
          </button>
        </form>
      </div>

      <!-- Update Image Modal -->
      <div id="imageModal" class="modal">
        <div class="modal-content">
          <h5>Update Image</h5>
          <p class="grey-text">Provide a URL/filename or upload a new file.</p>
          <div class="input-field">
            <input id="modalImageUrl" type="text" placeholder="images/image2.png">
            <label class="active" for="modalImageUrl">New Image URL / Filename</label>
          </div>
          <div class="file-field input-field">
            <div class="btn">
              <span>Attach</span>
              <input id="modalImageFile" type="file" accept="image/*">
            </div>
            <div class="file-path-wrapper">
              <input class="file-path validate" type="text" placeholder="Attach an image (optional)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
          <a href="#!" id="saveImageBtn" class="waves-effect waves-light btn">Save</a>
        </div>
      </div>

      <!-- Success Modal -->
      <div id="successModal" class="modal">
        <div class="modal-content">
          <div class="card">
            <div class="card-image">
              <img id="successImage" src="images/item-placeholder.png" alt="Uploaded item">
              <span class="card-title">Item added successfully</span>
            </div>
            <div class="card-content">
              <span class="new badge green" id="successType" data-badge-caption=""></span>
              <h6 id="successTitle" style="margin-top:8px;">—</h6>
              <p class="grey-text" id="successMeta">—</p>
              <p id="successDesc" class="mt-2">—</p>
            </div>
            <div class="card-action">
              <a href="#tab-all" class="modal-close">OK, show me on the board</a>
            </div>
          </div>
        </div>
      </div>

      <div class="site-footer">
        <small>Built with ❤️ — Lost & Found</small>
      </div>
    </div>
  </main>

  <!-- Floating Action Button -->
  <a href="#report" class="fab-report" title="Report item">
    <i class="material-icons">add</i>
  </a>

  <!-- Vendor scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <!-- Try local Socket.IO client first -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- Fallback to CDN if local failed -->
  <script>
    (function ensureSocketIO() {
      if (typeof io === 'undefined') {
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js';
        s.onload = function(){ console.log('[socket.io] CDN fallback loaded'); };
        s.onerror = function(){ console.warn('[socket.io] could not load client library'); };
        document.head.appendChild(s);
      }
    })();
  </script>

  <!-- App scripts -->
  <script src="js/auth.js"></script>
  <script src="js/scripts.js"></script>

  <!-- Theme persistence -->
  <script>
    (function(){
      var body = document.body;
      var toggle = document.getElementById('themeToggle');
      var label = document.getElementById('themeLabel');
      var saved = localStorage.getItem('theme') || 'light';
      if (saved === 'dark') { body.classList.add('theme-dark'); label.textContent='Light'; }
      toggle.addEventListener('click', function(e){
        e.preventDefault();
        body.classList.toggle('theme-dark');
        var dark = body.classList.contains('theme-dark');
        localStorage.setItem('theme', dark ? 'dark' : 'light');
        label.textContent = dark ? 'Light' : 'Dark';
      });
    })();
  </script>
</body>
</html>
